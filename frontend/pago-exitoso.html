<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬°Pago Exitoso! | Luminance Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --rosa-medio:#e75480; --rosa-fuerte:#d81b60; --lila-claro:#f4f0ff; --rosa-claro:#f8d7e6; --violeta:#6a4c93; }
        *{ margin:0; padding:0; box-sizing:border-box; }
        body{ font-family:'Poppins',sans-serif; background:linear-gradient(135deg,var(--rosa-claro),var(--lila-claro)); min-height:100vh; display:flex; align-items:center; justify-content:center; }
        .card{ background:white; border-radius:20px; padding:50px 40px; text-align:center; max-width:500px; width:90%; box-shadow:0 20px 60px rgba(0,0,0,0.1); animation:fadeIn 0.5s ease; }
        @keyframes fadeIn{ from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }
        .icon{ width:90px; height:90px; background:linear-gradient(135deg,#28a745,#20c963); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 25px; font-size:2.5rem; color:white; }
        h1{ font-family:'Playfair Display',serif; color:var(--violeta); font-size:2rem; margin-bottom:15px; }
        .subtitle{ color:#636e72; line-height:1.7; margin-bottom:25px; }
        .details{ background:var(--lila-claro); border-radius:12px; padding:20px; margin-bottom:25px; text-align:left; }
        .detail-row{ display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid rgba(0,0,0,0.07); font-size:0.9rem; }
        .detail-row:last-child{ border-bottom:none; }
        .detail-label{ color:#636e72; font-weight:500; }
        .detail-value{ color:var(--violeta); font-weight:600; }
        .badge{ background:#d4edda; color:#155724; padding:4px 12px; border-radius:20px; font-size:0.85rem; font-weight:600; }
        .btn{ display:inline-flex; align-items:center; gap:8px; padding:14px 32px; background:linear-gradient(135deg,var(--rosa-medio),var(--rosa-fuerte)); color:white; text-decoration:none; border-radius:50px; font-weight:600; transition:transform 0.2s,box-shadow 0.2s; }
        .btn:hover{ transform:translateY(-3px); box-shadow:0 10px 25px rgba(231,84,128,0.35); }
        .spinner{ border:3px solid #f0f0f0; border-top:3px solid var(--rosa-medio); border-radius:50%; width:35px; height:35px; animation:spin 0.8s linear infinite; margin:15px auto; }
        @keyframes spin{ to{transform:rotate(360deg)} }

        /* ============================================
        üì± RESPONSIVE - MOBILE
        ============================================ */

        @media (max-width: 768px) {
            /* Ajustar padding general */
            .container {
                padding: 20px 15px;
                width: 100%;
            }
            
            /* Hacer el header responsive */
            header nav ul {
                flex-direction: column;
                gap: 10px;
            }
            
            header nav ul li {
                width: 100%;
                text-align: center;
            }
            
            /* Botones m√°s grandes en m√≥vil */
            .btn {
                padding: 15px 20px;
                font-size: 16px;
                width: 100%;
            }
            
            /* Grids a una columna en m√≥vil */
            .services-grid,
            .services-grid-detailed,
            .aparato-grid {
                grid-template-columns: 1fr !important;
                gap: 20px;
            }
            
            /* Formularios m√°s anchos */
            input, select, textarea {
                width: 100%;
                font-size: 16px; /* Evita zoom en iOS */
            }
            
            /* Tablas scrolleables */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            /* Texto m√°s grande para lectura */
            body {
                font-size: 16px;
            }
            
            h1 { font-size: 28px; }
            h2 { font-size: 24px; }
            h3 { font-size: 20px; }
        }

        /* Tablets (768px - 1024px) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .services-grid-detailed {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="card">
    <div class="icon"><i class="fas fa-check"></i></div>
    <h1>¬°Pago Exitoso! üéâ</h1>
    <p class="subtitle">Tu turno est√° <strong>confirmado</strong>. Recibir√°s un email de confirmaci√≥n en breve. üíå</p>
    <div class="details" id="details"><div class="spinner"></div></div>
    <a href="/mis-turnos.html" class="btn"><i class="fas fa-calendar-check"></i> Ver mis turnos</a>
</div>
<script src="api.js"></script>
<script>
document.addEventListener('DOMContentLoaded', async () => {
    // MP redirige con: ?collection_status=approved&external_reference=APPOINTMENT_ID&collection_id=PAYMENT_ID
    const params   = new URLSearchParams(window.location.search);
    const aptId    = params.get('external_reference');
    const mpStatus = params.get('collection_status') || params.get('status');
    console.log('‚úÖ Retorno MP ‚Äî appointment_id:', aptId, '| status:', mpStatus);

    const el = document.getElementById('details');
    if (!aptId) { el.innerHTML = '<p style="text-align:center;color:#636e72;padding:10px">Turno confirmado ‚úÖ</p>'; return; }

    try {
        const apt  = await apiRequest('/appointments/' + aptId);
        const date = new Date(apt.appointment_date);
        const dateStr = date.toLocaleDateString('es-ES',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
        const h = String(date.getHours()).padStart(2,'0');
        const m = String(date.getMinutes()).padStart(2,'0');
        el.innerHTML = `
            <div class="detail-row"><span class="detail-label">üìÖ Fecha</span><span class="detail-value">${dateStr}</span></div>
            <div class="detail-row"><span class="detail-label">üïê Hora</span><span class="detail-value">${h}:${m} hs</span></div>
            <div class="detail-row"><span class="detail-label">üíÖ Servicio</span><span class="detail-value">${apt.service?.name || 'Turno #'+aptId}</span></div>
            <div class="detail-row"><span class="detail-label">‚úÖ Estado</span><span class="detail-value"><span class="badge">Confirmado</span></span></div>`;
    } catch(e) {
        el.innerHTML = '<p style="text-align:center;color:#636e72;padding:10px">Turno #' + aptId + ' confirmado ‚úÖ</p>';
    }
});
</script>
</body>
</html>
